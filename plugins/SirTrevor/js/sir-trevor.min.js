(function(f,d){function A(b){(b=b.e("data-st-name")||b.e("name"))||(b="Field");return d.Sa(b)}function u(){this.ld()}function r(b,a){function e(){this.constructor=g}var c=this,g;g=b&&d.gd(b,"constructor")?b.constructor:function(){return c.apply(this,arguments)};d.extend(g,c,a);e.prototype=c.prototype;g.prototype=new e;b&&d.extend(g.prototype,b);g.me=c.prototype;return g}var c;c={gc:!1,Na:!1,version:"0.3.0-rc.5",F:{xb:!1,ca:{className:"st-spinner",s:9,length:8,width:3,Ja:6,color:"#000",speed:1.4,eb:57,
bb:!1,left:"50%",top:"50%"},ub:0,vb:{},required:[],Rd:"/attachments",ye:"/sir-trevor-uploads/",Da:void 0},A:{},i:{},l:{},Xa:[]};c.X=Eventable;var x=!1,p={bound:[],O:function(){0<this.bound.length&&d.Be.apply(null,d.zf(this,this.bound))}},m={tagName:"div",className:"sir-trevor__view",attributes:{},I:function(b){return this.a.find(b)},H:function(){return this},P:function(){if(this.B)this.pb(this.B);else{var b=d.extend({},d.result(this,"attributes")),a;this.id&&(b.id=this.id);this.className&&(b["class"]=
this.className);b.c&&(a=b.c,delete b.c);b=f("<"+this.tagName+">").e(b);a&&b.c(a);this.pb(b)}},pb:function(b){this.a=b instanceof f?b:f(b);this.B=this.a[0];return this}};(function(b){b.ea.Me=function(){return this};b.ea.cf=function(){this.Zb("dragenter").Zb("dragover").Zb("dragleave");return this};b.ea.wb=function(){var a,b;a=document.createRange();a.selectNodeContents(this[0]);a.collapse(!1);b=window.getSelection();b.removeAllRanges();b.addRange(a)}})(jQuery);c.log=function(b){!d.b(console)&&c.gc&&
console.log(b)};(function(b,a,e){function c(b,e){var d=a.createElement(b||"div"),h;for(h in e)d[h]=e[h];return d}function d(a){for(var b=1,e=arguments.length;b<e;b++)a.appendChild(arguments[b]);return a}function f(a,b,e,c){var d=["opacity",b,~~(100*a),e,c].join("-");e=0.01+e/c*100;c=Math.max(1-(1-a)/b*(100-e),a);var h=s.substring(0,s.indexOf("Animation")).toLowerCase();return q[d]||(r.insertRule("@"+(h&&"-"+h+"-"||"")+"keyframes "+d+"{0%{opacity:"+c+"}"+e+"%{opacity:"+a+"}"+(e+0.01)+"%{opacity:1}"+
(e+b)%100+"%{opacity:"+a+"}100%{opacity:"+c+"}}",0),q[d]=1),d}function k(a,b){var c=a.style,d,h;if(c[b]!==e)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(h=0;h<m.length;h++)if(d=m[h]+b,c[d]!==e)return d}function l(a,b){for(var e in b)a.style[k(a,e)||e]=b[e];return a}function w(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)a[d]===e&&(a[d]=c[d])}return a}function p(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}
var m=["webkit","Moz","ms","O"],q={},s,r=function(){var b=c("style");return d(a.getElementsByTagName("head")[0],b),b.sheet||b.styleSheet}(),u={s:12,length:7,width:5,Ja:10,rotate:0,color:"#000",speed:1,eb:100,opacity:0.25,cd:20,zIndex:2E9,className:"spinner",top:"auto",left:"auto"},t=function y(a){if(!this.Ub)return new y(a);this.Nb=w(a||{},y.Sc,u)};t.Sc={};w(t.prototype,{Ub:function(a){this.stop();var b=this,e=b.Nb,d=b.B=l(c(0,{className:e.className}),{position:"relative",zIndex:e.zIndex}),g=e.Ja+
e.length+e.width,f,n;a&&(a.insertBefore(d,a.firstChild||null),n=p(a),f=p(d),l(d,{left:("auto"==e.left?n.x-f.x+(a.offsetWidth>>1):e.left+g)+"px",top:("auto"==e.top?n.y-f.y+(a.offsetHeight>>1):e.top+g)+"px"}));d.setAttribute("aria-role","progressbar");b.s(d,b.Nb);if(!s){var k=0,z=e.cd,q=z/e.speed,m=(1-e.opacity)/(q*e.eb/100),w=q/e.s;!function B(){k++;for(var a=e.s;a;a--){var c=Math.max(1-(k+a*w)%q*m,e.opacity);b.opacity(d,e.s-a,c,e)}b.timeout=b.B&&setTimeout(B,~~(1E3/z))}()}return b},stop:function(){var a=
this.B;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.B=e),this},s:function(a,b){function e(a,d){return l(c(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,Fe:d,transformOrigin:"left",transform:"rotate("+~~(360/b.s*v+b.rotate)+"deg) translate("+b.Ja+"px,0)",Ee:(b.width>>1)+"px"})}for(var v=0,k;v<b.s;v++)k=l(c(),{position:"absolute",top:1+~(b.width/2)+"px",transform:b.Te?"translate3d(0,0,0)":"",opacity:b.opacity,ve:s&&f(b.opacity,
b.eb,v,b.s)+" "+1/b.speed+"s linear infinite"}),b.bb&&d(k,l(e("#000","0 0 4px #000"),{top:"2px"})),d(a,d(k,e(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,b,e){b<a.childNodes.length&&(a.childNodes[b].style.opacity=e)}});!function(){function a(b,e){return c("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',e)}var b=l(c("group"),{Ae:"url(#default#VML)"});!k(b,"transform")&&b.te?(r.addRule(".spin-vml","behavior:url(#default#VML)"),t.prototype.s=function(b,e){function c(){return l(a("group",
{coordsize:n+" "+n,coordorigin:-f+" "+-f}),{width:n,height:n})}function h(b,n,k){d(q,d(l(c(),{rotation:360/e.s*b+"deg",left:~~n}),d(l(a("roundrect",{xe:1}),{width:f,height:e.width,left:e.Ja,top:-e.width>>1,filter:k}),a("fill",{color:e.color,opacity:e.opacity}),a("stroke",{opacity:0}))))}var f=e.length+e.width,n=2*f,k=2*-(e.width+e.length)+"px",q=l(c(),{position:"absolute",top:k,left:k});if(e.bb)for(k=1;k<=e.s;k++)h(k,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");
for(k=1;k<=e.s;k++)h(k);return d(b,q)},t.prototype.opacity=function(a,b,e,c){a=a.firstChild;c=c.bb&&c.s||0;a&&b+c<a.childNodes.length&&(a=a.childNodes[b+c],a=a&&a.firstChild,a=a&&a.firstChild,a&&(a.opacity=e))}):s=k(b,"animation")}();b.he=t})(window,document);c.Vc=function(b,a,e){var c;e=e||{};switch(a){case "create":a=d.trim(b.a.M());b.Z={data:[]};if(0<a.length)try{var g=JSON.parse(a);d.b(g.data)||(b.Z=g)}catch(f){b.o.push({text:"There was a problem loading the contents of the document"}),b.Rb(),
console.log("Sorry there has been a problem with parsing the JSON"),console.log(f)}break;case "reset":b.Z={data:[]};break;case "add":e.data&&(b.Z.data.push(e.data),c=b.Z);break;case "save":b.a.M(0<b.Z.data.length?JSON.stringify(b.Z):"");break;case "read":c=b.Z}if(c)return c};d.extend(u.prototype,{ld:function(){this.ta=f("input[type='submit']");var b=[];d.q(this.ta,function(a){b.push(f(a).e("value"))});this.Nd=b;this.R=0;this.oc()},Ld:function(b,a){this.ta.e("value",a)},Fd:function(){d.q(this.ta,function(b,
a){f(b).e("value",this.Nd[a])},this)},pf:function(){this.R++;c.log("onUploadStart called "+this.R);1===this.R&&this.sc()},qf:function(){this.R=0>=this.R?0:this.R-1;c.log("onUploadStop called "+this.R);0===this.R&&this.tc()},lf:function(){c.log("onError called")},sc:function(b){this.Ld(null,b||"Please wait...");this.ta.e("disabled","disabled").m("disabled")},tc:function(){this.Fd();this.ta.tf("disabled").n("disabled")},wc:{disableSubmitButton:"_disableSubmitButton",enableSubmitButton:"_enableSubmitButton",
setSubmitButton:"setSubmitButton",resetSubmitButton:"resetSubmitButton",onError:"onError",onUploadStart:"onUploadStart",onUploadStop:"onUploadStop"},oc:function(){d.forEach(this.wc,function(b,a){c.d.k(a,this[b],this)},this)}});c.Od=function(){new u};c.Zc=function(b,a,e,h){c.d.f("onUploadStart");var g=[b.g,(new Date).getTime(),"raw"].join("-"),n=new FormData;n.append("attachment[name]",a.name);n.append("attachment[file]",a);n.append("attachment[uid]",g);b.Sb();a=f.Hc({url:c.F.Rd,data:n,Ge:!1,contentType:!1,
sf:!1,type:"POST"});b.qb(g,a);a.Uc(function(a){c.log("Upload callback called");c.d.f("onUploadStop");!d.b(e)&&d.ba(e)&&d.bind(e,b)(a)}).Xc(function(a,e){c.log("Upload callback error called");c.d.f("onUploadStop");!d.b(h)&&d.ba(h)&&d.bind(h,b)(e)}).Ic(d.bind(b.Qb,b,g));return a};var C=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;d.bf({Ya:function(b){return C.test(b)},Sa:function(b){return b.charAt(0).toUpperCase()+b.substring(1).toLowerCase()},trim:function(b){return b.replace(/^\s\s*/,
"").replace(/\s\s*$/,"")},reverse:function(b){return b.split("").reverse().join("")},$c:function(b){var a={};d.q(b,function(e,c){a[d.isArray(b)?e:c]=!0});return a},Pd:function(b){return b.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}});c.t=function(b,a){var e=b,h="Text"===a;d.b(h)&&(h=!1);h&&(e="<div>"+e);var e=e.replace(/\[([^\]]+)\]\(([^\)]+)\)/gm,function(a,b,e){return"<a href='"+e+"'>"+b.replace(/\n/g,"")+"</a>"}),e=d.reverse(d.reverse(e).replace(/_(?!\\)((_\\|[^_])*)_(?=$|[^\\])/gm,
function(a,b){return">i/<"+b.replace(/\n/g,"").replace(/[\s]+$/,"")+">i<"}).replace(/\*\*(?!\\)((\*\*\\|[^\*\*])*)\*\*(?=$|[^\\])/gm,function(a,b){return">b/<"+b.replace(/\n/g,"").replace(/[\s]+$/,"")+">b<"})),e=e.replace(/^\> (.+)$/mg,"$1"),g,f;for(g in this.bd)c.l.hasOwnProperty(g)&&(f=c.l[g],!d.b(f.t)&&d.ba(f.t)&&(e=f.t(e)));c.i.hasOwnProperty(a)&&(g=c.i[a],!d.b(g.prototype.t)&&d.ba(g.prototype.t)&&(e=g.prototype.t(e)));h&&(e=e.replace(/\n\n/gm,"</div><div><br></div><div>"),e=e.replace(/\n/gm,
"</div><div>"));e=e.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\n/g,"<br>").replace(/\*\*/,"").replace(/__/,"");e=e.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\-/g,"-");h&&(e+="</div>");return e};c.w=function(b,a){function e(a,b,e){d.b(e)&&(e="");return"**"+b.replace(/<(.)?br(.)?>/g,"")+"**"+e}function h(a,b,e){d.b(e)&&(e="");return"_"+b.replace(/<(.)?br(.)?>/g,"")+"_"+e}var g;g=b.replace(/&nbsp;/g,
" ");g=g.replace(/( class=(")?Mso[a-zA-Z]+(")?)/g,"").replace(/\x3c!--(.*?)--\x3e/g,"").replace(/\/\*(.*?)\*\//g,"").replace(/<(\/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>/gi,"");var f="style script applet embed noframes noscript".split(" "),k,l;for(l=0;l<f.length;l++)k=RegExp("<"+f[l]+".*?"+f[l]+"(.*?)>","gi"),g=g.replace(k,"");g=g.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\-/g,"\\-");f=["em","i","strong",
"b"];for(l=0;l<f.length;l++)k=RegExp("<"+f[l]+"><br></"+f[l]+">","gi"),g=g.replace(k,"<br>");g=g.replace(/<(\w+)(?:\s+\w+="[^"]+(?:"\$[^"]+"[^"]+)?")*>\s*<\/\1>/gim,"").replace(/\n/mg,"").replace(/<a.*?href=[""'](.*?)[""'].*?>(.*?)<\/a>/gim,function(a,b,e){return"["+e.trim().replace(/<(.)?br(.)?>/g,"")+"]("+b+")"}).replace(/<strong>(?:\s*)(.*?)(\s)*?<\/strong>/gim,e).replace(/<b>(?:\s*)(.*?)(\s*)?<\/b>/gim,e).replace(/<em>(?:\s*)(.*?)(\s*)?<\/em>/gim,h).replace(/<i>(?:\s*)(.*?)(\s*)?<\/i>/gim,h);
for(var m in this.bd)c.l.hasOwnProperty(m)&&(k=c.l[m],!d.b(k.w)&&d.ba(k.w)&&(g=k.w(g)));g=g.replace(/([^<>]+)(<div>)/g,"$1\n$2").replace(/<div><div>/g,"\n<div>").replace(/(?:<div>)([^<>]+)(?:<div>)/g,"$1\n").replace(/(?:<div>)(?:<br>)?([^<>]+)(?:<br>)?(?:<\/div>)/g,"$1\n").replace(/<\/p>/g,"\n\n").replace(/<(.)?br(.)?>/g,"\n").replace(/&lt;/g,"<").replace(/&gt;/g,">");c.i.hasOwnProperty(a)&&(m=c.i[a],!d.b(m.prototype.w)&&d.ba(m.prototype.w)&&(g=m.prototype.w(g)));return g=g.replace(/<\/?[^>]+(>|$)/g,
"")};c.d=d.extend({},c.X);c.A.jb={oa:"Ajaxable",sb:!0,Ve:function(){this.ja=[]},qb:function(b,a){c.log("Adding queued item for "+this.g+" called "+b);this.ja.push({name:b,Tc:a})},Qb:function(b){c.log("Removing queued item for "+this.g+" called "+b);this.ja=d.yd(this.ja,function(a){return a.name==b})},Se:function(){return 0<this.ja.length},Gd:function(){d.q(this.ja,function(b){c.log("Aborting queued request: "+b.name);b.Tc.abort()},this)}};c.A.hc={oa:"Droppable",Ud:["File","Files","text/plain","text/uri-list"],
We:function(){c.log("Adding droppable to block "+this.g);this.$=d.extend({},c.F.u.$,this.$);var b=f(d.ha(this.$.c,{Ce:this}));this.C.v();this.W.append(b);this.D.m("st-block__inner--droppable")},pe:function(b){b.preventDefault();b=b.Ha;var a=f(b.target),e=b.dataTransfer.types;a.n("st-dropzone--dragover");!d.b(e)&&d.some(e,function(a){return d.Ue(this.Ud,a)},this)&&this.T(b.dataTransfer);c.d.f("block:content:dropped")}};c.A.jc={oa:"Fetchable",Xe:function(){this.ia(c.A.jb)},yb:function(b,a,e){var c=
d.fb(this.g+"_fetch");b=f.Hc(b);this.Sb();this.qb(c,b);d.b(a)||b.Uc(d.bind(a,this));d.b(e)||b.Xc(d.bind(e,this));b.Ic(d.bind(this.Qb,this,c));return b}};c.A.mc={oa:"Pastable",Ye:function(){c.log("Adding pastable to block "+this.g);this.ra=d.extend({},c.F.u.ra,this.ra);this.W.append(d.ha(this.ra.c,this));this.I(".st-paste-block")}};c.A.nc={oa:"Uploadable",Af:0,Ze:function(){c.log("Adding uploadable to block "+this.g);this.ia(c.A.jb);this.ua=d.extend({},c.F.u.ua,this.ua);this.W.append(d.ha(this.ua.c,
this))},Sd:function(b,a,e){return c.Zc(this,b,a,e)}};c.dc=function(){function b(a,b){this.V=a;this.na=b;this.cb=0;this.P();this.O();this.j()}d.extend(b.prototype,p,m,{bound:["onBlockCountChange","onSelectChange","toggle","show","hide"],className:"st-block-positioner",gb:"st-block-positioner--is-visible",j:function(){this.a.append("<div class='st-block-positioner__inner'>\n<span class='st-block-positioner__selected-value'></span>\n<select class='st-block-positioner__select'></select>\n</div>");this.ya=
this.I(".st-block-positioner__select");this.ya.k("change",this.sd);c.d.k(this.na+":blocks:count_update",this.od)},od:function(a){a!=this.cb&&(this.cb=a,this.Dd())},sd:function(){var a=this.ya.M();0!==a&&(c.d.f(this.na+":blocks:change_position",this.V,a,1==a?"before":"after"),this.toggle())},Dd:function(){for(var a="<option value='0'>Position</option>",b=1;b<=this.cb;b++)a+="<option value="+b+">"+b+"</option>";this.ya.c(a)},toggle:function(){this.ya.M(0);this.a.Ka(this.gb)},show:function(){this.a.m(this.gb)},
v:function(){this.a.n(this.gb)}});return b}();c.kb=function(){function b(a){this.V=a;this.P();this.O();this.j()}d.extend(b.prototype,p,m,{bound:"onMouseDown onClick onDragStart onDragEnd onDrag onDrop".split(" "),className:"st-block-ui-btn st-block-ui-btn--reorder st-icon",tagName:"a",attributes:function(){return{html:"reorder",draggable:"true","data-icon":"move"}},j:function(){},nf:function(){c.d.f("block:reorder:down")},T:function(a){a.preventDefault();var b=this.V;a=a.Ha.dataTransfer.getData("text/plain");
var h=f("#"+a);d.b(a)||d.K(h)||b.e("id")==a||b.e("data-instance")!=h.e("data-instance")||b.rb(h);c.d.f("block:reorder:dropped",a)},kf:function(a){var b=f(a.currentTarget).parent();a.Ha.dataTransfer.setDragImage(this.V[0],b.position().left,b.position().top);a.Ha.dataTransfer.setData("Text",this.V.e("id"));c.d.f("block:reorder:dragstart");this.V.m("st-block--dragging")},jf:function(){c.d.f("block:reorder:dragend");this.V.n("st-block--dragging")},hf:function(){},Ga:function(){},H:function(){return this}});
return b}();c.cc=function(){function b(){this.P();this.O()}d.extend(b.prototype,p,m,{tagName:"a",className:"st-block-ui-btn st-block-ui-btn--delete st-icon",attributes:{c:"delete","data-icon":"bin"}});return b}();c.fc={o:[],valid:function(){this.Za();return 0===this.o.length},Za:function(){this.Ed();var b=this.I(".st-required");d.q(b,this.Xd,this);d.q(this.Yd,this.Hd,this);this.a.Ka("st-block--with-errors",0<this.o.length)},Yd:[],Xd:function(b){b=f(b);0===(b.e("contenteditable")?b.text():b.M()).length&&
this.Kd(b,A(b)+" must not be empty")},Hd:function(b){d.b(this[b])||this[b].call(this)},Kd:function(b,a){var e=this.Qa(a,"st-msg--error");b.m("st-error");this.o.push({field:b,reason:a,md:e})},Ed:function(){d.q(this.o,function(b){b.field.n("st-error");b.md.remove()});this.Ma.n("st-block__messages--is-visible");this.o=[]}};c.ec={Ca:{},createStore:function(b){this.Ca={type:this.type.toLowerCase(),data:b||{}}},save:function(){this.Xb()},Id:function(){this.save();return this.Ca},getData:function(){return this.Ca.data},
setData:function(b){c.log("Setting data for block "+this.g);d.extend(this.Ca.data,b||{})},vf:function(b){this.setData(b);return this.getData()},ab:function(b){this.setData(b);this.da()},Xb:function(){},L:function(){},da:function(){c.log("loadData for "+this.g);c.d.f("editor/block/loadData");this.L(this.getData())},qe:function(){c.log("_loadData is deprecated and will be removed in the future. Please use beforeLoadingData instead.");this.da()},Qc:function(){d.K(this.getData())||this.da()}};c.Aa=function(){function b(a,
b){this.createStore(a);this.g=d.fb("st-block-");this.na=b;this.P();this.O();this.j.apply(this,arguments)}d.extend(b.prototype,p,c.X,m,c.ec,{focus:function(){},valid:function(){return!0},className:"st-block",Lc:d.ha("<div class='st-block__inner'><%= editor_html %></div>"),attributes:function(){return{id:this.g,"data-type":this.type,"data-instance":this.na}},title:function(){return d.Sa(this.type)},tb:function(){return this.tb=d.Pd(this.type)},type:"",la:"",j:function(){},Fa:function(){},ze:function(){},
ob:function(){var a=d.result(this,"editorHTML");this.a.append(this.Lc({Ne:a}));this.D=this.a.find(".st-block__inner")},H:function(){this.ob();this.lb();this.Fa();return this},lb:function(){this.Cc();this.Ac();this.Qc();this.a.m("st-item-ready");this.save()},Ba:function(a,b,c){this.ib.append(a.H().a);b&&c&&this.ib.k("click",b,c)},Cc:function(){var a=f("<div>",{"class":"st-block__ui"});this.D.append(a);this.ib=a;this.nb()},Ac:function(){var a=f("<div>",{"class":"st-block__messages"});this.D.Ia(a);this.Ma=
a},Qa:function(a,b){var c=f("<span>",{c:a,He:"st-msg "+b});this.Ma.append(c).m("st-block__messages--is-visible");return c},Sb:function(){this.Ma.c("").n("st-block__messages--is-visible")},nb:function(){this.Ba(new c.kb(this.a))}});b.ea=b.prototype;b.extend=r;return b}();c.u=function(){function b(a,b){c.Aa.apply(this,arguments)}c.F.u={$:{c:'<div class="st-block__dropzone">\n<span class="st-icon"><%= _.result(block, "icon_name") %></span>\n<p>Drag <span><%= block.type %></span> here</p></div>',Pb:!1},
ra:{c:'<input type="text" placeholder="Or paste URL here" class="st-block__paste-input st-paste-block">'},ua:{c:'<div class="st-block__upload-container">\n<input type="file" type="st-file-upload">\n<button class="st-upload-btn">...or choose a file</button>\n</div>'}};d.extend(b.prototype,c.Aa.ea,c.fc,{bound:"_handleContentPaste _onFocus _onBlur onDrop onDeleteClick clearInsertedStyles getSelectionForFormatter".split(" "),className:"st-block st-icon--add",attributes:function(){return d.extend(c.Aa.ea.attributes.call(this),
{"data-icon-after":"add"})},S:"default",Bf:function(){return this.type+" block is invalid"},la:'<div class="st-block__editor"></div>',Qd:!0,aa:!1,ga:!1,La:!1,Va:!1,sb:!1,$:{},ra:{},ua:{},ad:!0,j:function(){},w:function(a){return a},t:function(a){return a},ia:function(a){if(d.af(a)){var b="initialize"+a.oa;d.b(this[b])&&(d.extend(this,a),this[b]())}},H:function(){this.ob();this.C=this.D.children().first();if(this.aa||this.ga||this.La){var a=f("<div>",{"class":"st-block__inputs"});this.D.append(a);
this.W=a}this.Wa&&this.Bc();this.aa&&this.ia(c.A.hc);this.ga&&this.ia(c.A.mc);this.La&&this.ia(c.A.nc);this.Va&&this.ia(c.A.jc);this.ad&&this.zc();this.lb();this.Fa();return this},remove:function(){this.a.remove()},Ea:function(){d.b(this.ca)||this.U();this.ca=new Spinner(c.F.ca);this.ca.Ub(this.a[0]);this.a.m("st--is-loading")},U:function(){this.a.n("st--is-loading");d.b(this.ca)||(this.ca.stop(),delete this.ca)},Xb:function(){c.log("toData for "+this.g);var a={};if(this.Wa()){var b=this.r().c();
0<b.length&&(a.text=c.w(b,this.type))}var h=!d.b(a.text)||!this.Wa();0<this.I('input[type="text"]').df(".st-paste-block").length&&this.I('input[type="text"]').q(function(b,e){e=f(e);h&&(a[e.e("name")]=e.M())});d.K(a)||this.setData(a)},focus:function(){this.r().focus()},blur:function(){this.r().blur()},rd:function(){this.r()},pd:function(){this.r()},se:function(){this.f("blockFocus",this.a)},re:function(){},T:function(){},qd:function(a){a.preventDefault();this.D.append("<div class='st-block__ui-delete-controls'>\n<label class='st-block__delete-label'>Delete?</label>\n<a class='st-block-ui-btn st-block-ui-btn--confirm-delete st-icon' data-icon='tick'></a>\n<a class='st-block-ui-btn st-block-ui-btn--deny-delete st-icon' data-icon='close'></a>\n</div>");
this.a.m("st-block--delete-active");var b=this.D.find(".st-block__ui-delete-controls");this.D.k("click",".st-block-ui-btn--confirm-delete",d.bind(function(a){a.preventDefault();this.f("removeBlock",this.g)},this)).k("click",".st-block-ui-btn--deny-delete",d.bind(function(a){a.preventDefault();this.a.n("st-block--delete-active");b.remove()},this))},Ob:function(a){return c.t(c.w(a,this.type),this.type)},pa:function(a,b){b.c(this.Ob(b[0].innerHTML));this.r().wb()},da:function(){this.Ea();if(this.aa||
this.La||this.ga)this.C.show(),this.W.v();c.Aa.ea.da.call(this);this.U()},oe:function(a){var b=f(a.currentTarget);d.Ke(d.bind(this.pa,this,a,b),0)},ne:function(){return"st-block--"+this.className},nb:function(){var a=new c.dc(this.a,this.na);this.Ba(a,".st-block-ui-btn--reorder",a.toggle);this.Ba(new c.kb(this.a));this.Ba(new c.cc,".st-block-ui-btn--delete",this.qd);this.rd();this.pd()},zc:function(){var a,b;for(b in c.l)c.l.hasOwnProperty(b)&&(a=c.l[b],d.b(a.keyCode)||a.pc(this.a))},Bc:function(){this.r()},
Re:function(){""===window.getSelection().toString().trim()?c.d.f("formatter:hide"):c.d.f("formatter:positon")},Ie:function(a){a.target.removeAttribute("style")},Wa:function(){return 0<this.r().length},r:function(){d.b(this.Wb)&&(this.Wb=this.I(".st-text-block"));return this.Wb}});b.extend=r;return b}();c.za=function(){function b(a){d.fb("format-");this.rc(a||{});this.j.apply(this,arguments)}var a="title className cmd keyCode param onClick toMarkdown toHTML".split(" ");d.extend(b.prototype,{title:"",
className:"",Q:null,keyCode:null,vd:null,w:function(a){return a},t:function(a){return a},j:function(){},rc:function(b){this.options&&(b=d.extend({},this.options,b));for(var c=0,g=a.length;c<g;c++){var f=a[c];b[f]&&(this[f]=b[f])}this.options=b},Kb:function(){return document.queryCommandState(this.Q)},pc:function(a){var b=!1;a.k("keyup",".st-text-block",function(a){if(17==a.which||224==a.which||91==a.which)b=!1}).k("keydown",".st-text-block",{Bb:this},function(a){if(17==a.which||224==a.which||91==
a.which)b=!0;a.which==a.data.Bb.keyCode&&!0===b&&(document.execCommand(a.data.Bb.Q,!1,!0),a.preventDefault(),b=!1)})}});b.extend=r;return b}();c.i.ge=function(){var b=d.ha('<blockquote class="st-required st-text-block" contenteditable="true"></blockquote>\n<label class="st-input-label">Credit</label>\n<input maxlength="140" name="cite" placeholder="Credit" class="st-input-string st-required js-cite-input" type="text" />');return c.u.extend({type:"Quote",S:"quote",la:function(){return b(this)},L:function(a){this.r().c(c.t(a.text,
this.type));this.I(".js-cite-input").M(a.cite)},w:function(a){return a.replace(/^(.+)$/mg,"> $1")}})}();c.i.ae=function(){return c.u.extend({type:"Embedly",key:"",aa:!0,ga:!0,Va:!0,S:"embed",L:function(b){b.c?(this.C.m("st-block__editor--with-sixteen-by-nine-media"),this.C.c(b.c)):"photo"==b.type&&this.C.c('<img src="'+b.url+'" />')},pa:function(b){b=f(b.target).M();this.ma(b)},ma:function(b){d.Ya(b)?(this.Ea(),this.yb({url:this.Nc(b),dataType:"jsonp"},d.bind(function(a){this.ab(a);this.U()},this),
d.bind(function(){this.U()},this))):c.log("Must be a URL")},Nc:function(b){return"//api.embed.ly/1/oembed?key="+this.key+"&url="+escape(b)},T:function(b){this.ma(b.getData("text/plain"))}})}();c.i.be=c.u.extend({type:"Heading",la:'<div class="st-required st-text-block st-text-block--heading" contenteditable="true"></div>',S:"heading",L:function(b){this.r().c(c.t(b.text,this.type))}});c.i.ce=c.u.extend({type:"Image",aa:!0,La:!0,S:"image",L:function(b){this.C.c(f("<img>",{src:b.file.url}))},Fa:function(){this.W.find("button");
this.W.find("input").k("change",d.bind(function(b){this.T(b.currentTarget)},this))},T:function(b){b=b.files[0];var a="undefined"!==typeof URL?URL:"undefined"!==typeof webkitURL?webkitURL:null;/image/.test(b.type)&&(this.Ea(),this.W.v(),this.C.c(f("<img>",{src:a.createObjectURL(b)})).show(),c.d.f("setSubmitButton",["Please wait..."]),this.Sd(b,function(a){this.setData(a);this.U()},function(){this.Qa("There was a problem with your upload");this.U()}))}});c.i.ie=c.u.extend({type:"Text",la:'<div class="st-required st-text-block" contenteditable="true"></div>',
S:"text",L:function(b){this.r().c(c.t(b.text,this.type))}});c.i.je=function(){var b=d.ha("<blockquote class='twitter-tweet' align='center'>\n<p><%= text %></p>\n&mdash; <%= user.name %> (@<%= user.screen_name %>)\n<a href='<%= status_url %>' data-datetime='<%= created_at %>'><%= created_at %></a>\n</blockquote>\n<script src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\">\x3c/script>");return c.u.extend({type:"Tweet",aa:!0,ga:!0,Va:!0,$:{Pb:!0},Yc:function(a){return"/tweets/?tweet_id="+a},
S:"twitter",L:function(a){d.b(a.Vb)&&(a.Vb="");this.D.find("iframe").remove();this.D.Ia(b(a))},pa:function(a){a=f(a.target).M();this.Eb(a)},Eb:function(a){this.Td(a)?(a=a.match(/[^\/]+$/),d.K(a)||(this.Ea(),a=a[0],this.yb({url:this.Yc(a),dataType:"json"},this.ud,this.td))):c.log("Invalid Tweet URL")},Td:function(a){return d.Ya(a)&&-1!==a.indexOf("twitter")&&-1!==a.indexOf("status")},ud:function(a){this.ab({va:{wd:a.va.wd,xd:a.va.xd,Tb:a.va.Tb,name:a.va.name},id:a.jd,text:a.text,Rc:a.Rc,entities:a.entities,
Vb:"https://twitter.com/"+a.va.Tb+"/status/"+a.jd});this.U()},td:function(){this.Qa("There was a problem fetching your tweet");this.U()},T:function(a){a=a.getData("text/plain");this.Eb(a)}})}();c.i.fe=function(){return c.u.extend({type:"List",S:"list",la:function(){return d.ha('<div class="st-text-block" contenteditable="true"><ul><li></li></ul></div>',this)},L:function(b){this.r().c("<ul>"+c.t(b.text,this.type)+"</ul>")},Fa:function(){this.Ta=d.bind(this.Ta,this);this.r().k("click keyup",this.Ta)},
Ta:function(){0===this.I("ul").length&&document.execCommand("insertUnorderedList",!1,!1)},w:function(b){return b.replace(/<\/li>/mg,"\n").replace(/<\/?[^>]+(>|$)/g,"").replace(/^(.+)$/mg," - $1")},t:function(b){return b=b.replace(/^ - (.+)$/mg,"<li>$1</li>").replace(/\n/mg,"")},pa:function(b,a){var c=this.Ob(a[0].innerHTML);this.I("ul").c(c);this.r().wb()}})}();c.i.le=function(){var b=/http[s]?:\/\/(?:www.)?(?:(vimeo).com\/(.*))|(?:(youtu(?:be)?).(?:be|com)\/(?:watch\?v=)?([^&]*)(?:&(?:.))?)/;return c.u.extend({type:"Video",
aa:!0,ga:!0,S:"video",L:function(a){this.C.m("st-block__editor--with-sixteen-by-nine-media");"youtube"==a.source||"youtu"==a.source?this.C.c('<iframe src="'+window.location.protocol+"//www.youtube.com/embed/"+a.$a+'" width="580" height="320" frameborder="0" allowfullscreen></iframe>'):"vimeo"==a.source&&this.C.c('<iframe src="'+window.location.protocol+"//player.vimeo.com/video/"+a.$a+'?title=0&byline=0" width="580" height="320" frameborder="0"></iframe>')},pa:function(a){a=f(a.target).M();this.ma(a)},
ma:function(a){if(d.Ya(a)&&(-1!=a.indexOf("youtu")||-1!=a.indexOf("vimeo"))){var c={};a=a.match(b);void 0!==a[3]?(c.source=a[3],c.$a=a[4]):void 0!==a[1]&&(c.source=a[1],c.$a=a[2]);"youtu"==c.source&&(c.source="youtube");this.ab(c)}},T:function(a){a=a.getData("text/plain");this.ma(a)}})}();(function(){var b=c.za.extend({title:"bold",Q:"bold",keyCode:66,text:"B"}),a=c.za.extend({title:"italic",Q:"italic",keyCode:73,text:"i"}),e=c.za.extend({title:"link",Ib:"link",Q:"CreateLink",text:"link",Ga:function(){var a=
prompt("Enter a link"),b=/(ftp|http|https):\/\/./;a&&0<a.length&&(b.test(a)||(a="http://"+a),document.execCommand(this.Q,!1,a))},Kb:function(){var a=window.getSelection(),b;0<a.rangeCount&&(b=a.getRangeAt(0).startContainer.parentNode);return b&&"A"==b.nodeName}}),d=c.za.extend({title:"unlink",Ib:"link",Q:"unlink",text:"link"});c.l.$d=new b;c.l.de=new a;c.l.ee=new e;c.l.ke=new d})();c.ac=function(){function b(a,b){this.type=a;this.Jb=b;this.P();this.j()}d.extend(b.prototype,p,m,c.X,{tagName:"a",className:"st-block-control",
attributes:function(){return{"data-type":this.type}},j:function(){this.Ra=c.i[this.type].prototype;this.Oc=this.Ra.Qd},H:function(){this.a.c('<span class="st-icon">'+d.result(this.Ra,"icon_name")+"</span>"+d.result(this.Ra,"title"));return this}});return b}();c.bc=function(){function b(a,b){this.Jb=b;this.Jc=a||[];this.P();this.O();this.j()}d.extend(b.prototype,p,m,c.X,{bound:["handleControlButtonClick"],h:null,className:"st-block-controls",c:"<a class='st-icon st-icon--close'>close</a>",j:function(){for(var a in this.Jc)if(c.i.hasOwnProperty(a)){var b=
new c.ac(a,this.Jb);b.Oc&&this.a.append(b.H().a)}this.a.Le(".st-block-control","click",this.fd)},show:function(){this.a.m("st-block-controls--active")},v:function(){this.a.n("st-block-controls--active")},fd:function(a){a.stopPropagation();this.f("createBlock",f(a.currentTarget).e("data-type"))}});return b}();c.kc=function(){function b(a,b){this.p=a;this.kd=b;this.P();this.O();this.j()}d.extend(b.prototype,p,m,c.X,{className:"st-block-controls__top",attributes:function(){return{"data-icon":"add"}},
bound:["handleBlockMouseOut","handleBlockMouseOver","handleBlockClick","onDrop"],j:function(){this.a.k("click",this.Db);this.p.k("mouseover",".st-block",this.ed).k("mouseout",".st-block",this.dd).k("click",".st-block--with-plus",this.Db)},T:function(a){a.preventDefault();var b=this.a;a=a.Ha.dataTransfer.getData("text/plain");var h=f("#"+a);d.b(a)||d.K(h)||b.e("id")==a||this.kd!=h.e("data-instance")||b.rb(h);c.d.f("block:reorder:dropped",a)},ed:function(a){a=f(a.currentTarget);a.hd("st-block--with-plus")||
a.m("st-block--with-plus")},dd:function(a){a=f(a.currentTarget);a.hd("st-block--with-plus")&&a.n("st-block--with-plus")},Db:function(a){a.stopPropagation();a=f(a.currentTarget);this.f("showBlockControls",a)}});return b}();c.lc=function(){function b(a){this.options=d.extend({},c.F.fa,a||{});this.P();this.O();this.j.apply(this,arguments)}d.extend(b.prototype,p,c.X,m,{className:"st-format-bar",bound:["onFormatButtonClick","renderBySelection","hide"],j:function(){var a,b;this.hb=[];for(a in c.l)c.l.hasOwnProperty(a)&&
(b=c.l[a],b=f("<button>",{"class":"st-format-btn st-format-btn--"+a+" "+(b.Ib?"st-icon":""),text:b.text,"data-type":a,"data-cmd":b.Q}),this.hb.push(b),b.we(this.a));f(document)},v:function(){this.a.n("st-format-bar--is-ready")},show:function(){this.a.m("st-format-bar--is-ready")},remove:function(){this.a.remove()},Cd:function(){var a=window.getSelection().getRangeAt(0).getBoundingClientRect(),b={};b.top=a.top+20+window.pageYOffset-this.a.height()+"px";b.left=(a.left+a.right)/2-this.a.width()/2+"px";
this.Hb();this.show();this.a.Je(b)},Hb:function(){var a;d.q(this.hb,function(b){a=c.l[b.e("data-type")];b.Ka("st-format-btn--is-active",a.Kb())},this)},mf:function(a){a.stopPropagation();a=f(a.target);var b=c.l[a.e("data-type")];if(d.b(b))return!1;!d.b(b.Ga)&&d.ba(b.Ga)?b.Ga():document.execCommand(a.e("data-cmd"),!1,b.vd);this.Hb();return!1}});return b}();c.ic=function(){function b(a){c.log("Init SirTrevor.Editor");this.ka={};this.Y={};this.G=[];this.o=[];this.options=d.extend({},c.F,a||{});this.N=
d.fb("st-editor-");if(!this.uc())return!1;!d.b(this.options.qa)&&d.ba(this.options.qa)&&(this.qa=this.options.qa);this.Gc();this.Ec();this.O();this.sa("create");this.Mc();c.Xa.push(this);c.Kc()}d.extend(b.prototype,p,c.X,{bound:"onFormSubmit showBlockControls hideAllTheThings hideBlockControls onNewBlockCreated changeBlockPosition onBlockDragStart onBlockDragEnd removeBlockDragOver onBlockDropped createBlock".split(" "),Wc:{"block:reorder:down":"hideBlockControls","block:reorder:dragstart":"onBlockDragStart",
"block:reorder:dragend":"onBlockDragEnd","block:content:dropped":"removeBlockDragOver","block:reorder:dropped":"onBlockDropped","block:create:new":"onNewBlockCreated"},j:function(){},Mc:function(){this.a.v();this.h=new c.bc(this.ka,this.N);this.Ab=new c.kc(this.p,this.N);this.fa=new c.lc(this.options.fa);this.Lb(this.h,"createBlock",this.Ua);this.Lb(this.Ab,"showBlockControls",this.Md);this.Fc();c.d.k(this.N+":blocks:change_position",this.Pc);c.d.k("formatter:positon",this.fa.Cd);c.d.k("formatter:hide",
this.fa.v);this.p.Ia(this.Ab.H().a);f(document.body).append(this.fa.H().a);this.xa.append(this.h.H().a);f(window);var a=this.sa("read");0<a.data.length?d.q(a.data,function(a){c.log("Creating: "+a.type);this.Ua(a.type,a.data)},this):!1!==this.options.xb&&this.Ua(this.options.xb,{});this.p.m("st-ready");d.b(this.qa)||this.qa()},Fc:function(){d.q(this.Wc,function(a,b){c.d.k(b,this[a],this)},this)},Fb:function(){this.h.v();this.fa.v();d.b(this.h.J)||this.h.J.n("with-st-controls")},Md:function(a){d.b(this.h.J)||
this.h.J.n("with-st-controls");this.h.show();a.append(this.h.a.detach());a.m("with-st-controls");this.h.J=a},sa:function(a,b){return c.Vc(this,a,b||{})},Ua:function(a,b){a=d.Sa(a);if(this.Oa())return c.log("Cannot add any more blocks. Limit reached."),!1;if(!this.Pa(a))return c.log("Block type not available "+a),!1;if(!this.qc(a))return c.log("Block Limit reached for type "+a),!1;var f=new c.i[a](b,this.N);this.Dc(f.H().a);this.Lb(f,"removeBlock",this.zd);this.G.push(f);this.yc(a);f.focus();c.d.f(b?
"block:create:existing":"block:create:new",f);c.log("Block created of type "+a);this.p.Ka("st--block-limit-reached",this.Oa());this.Yb()},of:function(a){this.Gb();this.scrollTo(a.a)},scrollTo:function(a){f("html, body").ue({scrollTop:a.position().top},300,"linear")},De:function(){this.h.J=null},Gb:function(){d.b(this.h.J)||this.h.J.n("with-st-controls");this.h.v()},Ad:function(){this.xa.find(".st-drag-over").n("st-drag-over")},Yb:function(){c.d.f(this.N+":blocks:count_update",this.G.length)},Pc:function(a,
b){b-=1;var c=this.Cb(a),d=this.p.find(".st-block").Oe(b);this.Cb(d);c=c>b?"Before":"After";d&&d.e("id")!==a.e("id")&&(this.Fb(),a["insert"+c](d),this.scrollTo(a))},gf:function(a){this.Fb();a=this.zb(a);d.b(a)||d.K(a.getData())||!a.$.Pb||a.da()},ff:function(){this.Gb();this.p.m("st-outer--is-reordering")},ef:function(){this.Ad();this.p.n("st-outer--is-reordering")},Dc:function(a){this.h.J?this.h.J.rb(a):this.p.append(a)},yc:function(a){this.Y[a]=d.b(this.Y[a])?1:this.Y[a]+1},mb:function(a){return d.b(this.Y[a])?
0:this.Y[a]},qc:function(a){var b=this.xc(a);return!(0!==b&&this.mb(a)>=b)},Oa:function(){return 0!==this.options.ub&&this.G.length>=this.options.ub},zd:function(a){var b=this.zb(a);a=b.a.find(".st-block-controls");a.length&&(this.h.v(),this.p.Ia(a));this.Y[b.type]-=1;this.G=d.yd(this.G,function(a){return a.g==b.g});this.yf(b);b.sb&&b.Gd();b.remove();c.d.f("block:remove");this.Yb();this.p.Ka("st--block-limit-reached",this.Oa())},Za:function(a,b){var f=0;c.Na||!b||a.valid()||(this.o.push({text:d.result(a,
"validationFailMsg")}),c.log("Block "+a.g+" failed validation"),++f);return f},Jd:function(a){var b=a.Id();b&&!d.K(b.data)&&(c.log("Adding data for block "+a.g+" to block store"),this.sa("add",{data:b}))},Mb:function(a){a=!1===a?!1:!0;c.log("Handling form submission for Editor "+this.N);this.Bd();this.sa("reset");this.Wd(a);this.Vd(a);this.Rb();this.sa("save");return this.o.length},Wd:function(a){if(!this.required&&c.Na&&!a)return!1;d.q(this.p.find(".st-block"),function(b){var c=d.find(this.G,function(a){return a.g==
f(b).e("id")});if(d.b(c))return!1;this.Za(c,a);this.Jd(c)},this)},Vd:function(a){function b(a){if(this.Pa(a))if(0===this.mb(a))c.log("Failed validation on required block type "+a),this.o.push({text:"You must have a block of type "+a});else{if(0<d.filter(this.G,function(b){return b.type==a&&!d.K(b.getData())}).length)return!1;this.o.push({text:"A required block type "+a+" is empty"});c.log("A required block type "+a+" is empty")}}if(!this.required&&c.Na&&!a)return!1;d.isArray(this.required)&&d.q(this.required,
b,this)},Rb:function(){if(0===this.o.length)return!1;d.b(this.wa)&&(this.wa=this.vc());var a="<ul>";d.q(this.o,function(b){a+='<li class="st-errors__msg">'+b.text+"</li>"});a+="</ul>";this.wa.append(a);this.wa.show()},vc:function(){if(d.b(this.options.Da)){var a=f("<div>",{"class":"st-errors",c:"<p>You have the following errors: </p>"});this.xa.Ia(a);return a}return this.options.Da instanceof f?this.options.Da:f(this.options.Da)},Bd:function(){if(0===this.o.length)return!1;this.wa.v().find("ul").c("");
this.o=[]},zb:function(a){return d.find(this.G,function(b){return b.g==a})},Qe:function(a){return d.filter(this.G,function(b){return b.type==a})},Pe:function(a){return d.filter(this.G,function(b){return d.contains(a,b.g)})},Cb:function(a){return this.p.find(".st-block").index(a)},xc:function(a){return this.Pa(a)?parseInt(d.b(this.options.vb[a])?0:this.options.vb[a],10):0},Pa:function(a){return!d.b(this.ka[a])},uc:function(){if(d.b(this.options.B)||d.K(this.options.B))return c.log("You must provide an el"),
!1;this.a=this.options.B;this.B=this.options.B[0];this.$b=this.a.rf("form");var a=f("<div>").e({id:this.N,"class":"st-outer",dropzone:"copy link move"}),b=f("<div>").e({"class":"st-blocks"});this.a.Zd(a).Zd(b);this.xa=this.$b.find("#"+this.N);this.p=this.xa.find(".st-blocks");return!0},Ec:function(){this.ka=d.$c(d.b(this.options.ka)?c.i:this.options.ka)},Gc:function(){this.required=d.isArray(this.options.required)&&!d.K(this.options.required)?this.options.required:!1}});return b}();c.xf=function(b){c.F=
d.extend(c.F,b||{})};c.Kc=function(){x||(c.Od(),x=!0)};c.nd=function(){var b=0;d.q(c.Xa,function(a){b+=a.Mb(void 0)});c.log("Total errors: "+b);return b};c.Mb=function(b){0<c.nd()&&(c.d.f("onError"),b.preventDefault())};c.wf=function(b,a){var e=c.i[b];d.b(e)||d.extend(e.prototype,a||{})};c.uf=function(b){d.gd(c.ic.prototype,b)?([].unshift.call(arguments,c.Xa),d.$e.apply(d,arguments)):c.log("method doesn't exist")}})(jQuery,_);
